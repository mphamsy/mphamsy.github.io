<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>CNN: Age-gender Image Classification | Michal Pham Sy</title> <meta name="author" content="Michal Pham Sy"/> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://mphamsy.github.io/projects/CNN_age_gender/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Michal </span>Pham Sy</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About Me</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Project Portfolio</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">CNN: Age-gender Image Classification</h1> <p class="post-description"></p> </header> <article> <div class="row"> <div class="col-md-5 offset-md-3"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/cnnprof.JPG-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/cnnprof.JPG-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/cnnprof.JPG-1400.webp"></source> <img src="/assets/img/cnnprof.JPG" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Age-Gender Classification" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="requirements"><strong>Requirements</strong></h3> <p>This project is written in Python and requires the following libraries to be <strong>installed</strong> and <strong>imported</strong>.</p> <script src="https://gist.github.com/mphamsy/e133b225d5e4814adfd9e18f70f30b63.js"></script> <p>The project is undertaken with GoogleColab due to GPU requirements with images stored locally.</p> <script src="https://gist.github.com/mphamsy/371650ed2089a2fd5a73285acf9b8a99.js"></script> <h3 id="dataset"><strong>Dataset</strong></h3> <p>The dataset chosen for this project is a fraction of the UTKFace dataset containing facial images of people aged from 0 to 116 with resolution of 128x128. These types of datasets are important and widely used for computer vision tasks. This assignment will only use a fraction of the dataset, which will equate to 5000 images total. These images will be randomly split to training and testing datasets as follows:</p> <ul> <li>The training dataset size: 3500</li> <li>The testing dataset size: 1500</li> </ul> <p>The information about gender, age and ethncity are encoded within each <strong>filename</strong>. The information is presented as following:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sample Filename: 96_1_2_20170110175716420.jpg.chip.jpg
Encoded Meaning: Age_Gender_Ethnicity_Timestamp.jpg.chip.jpg
</code></pre></div></div> <p>The visualisation of the dataset is provided below. 20 images are displayed with age and gender shown above each picture.</p> <script src="https://gist.github.com/mphamsy/36ebd8842e2e4ccfad3a1949370ffb20.js"></script> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/cnnage.JPG-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/cnnage.JPG-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/cnnage.JPG-1400.webp"></source> <img src="/assets/img/cnnage.JPG" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Example Data" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Sample images with age and gender captions </div> <p><br></p> <h3 id="pre-processing"><strong>Pre-processing</strong></h3> <p>The train and test images were stores inside respective train and test dataframes. The dataset was randomly split accordingly to dataset sizes proposed in the <strong>Datatset</strong> section.</p> <script src="https://gist.github.com/mphamsy/0b4902b9a06c3e0b784e5ae2188a6ce3.js"></script> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/agehist.JPG-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/agehist.JPG-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/agehist.JPG-1400.webp"></source> <img src="/assets/img/agehist.JPG" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Age histogram" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/genhist.JPG-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/genhist.JPG-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/genhist.JPG-1400.webp"></source> <img src="/assets/img/genhist.JPG" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Gender histogram" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Age Frequency Histogram (Left) and Gender Frequency Histogram (Right) </div> <p><br></p> <h3 id="data-augmentation"><strong>Data Augmentation</strong></h3> <p><strong>Data Augmentation</strong> is commonly used for Computer Vision projects to synthetically increase the size of dataset by manipulating existing images. This is achieved through rotating, zooming, shearing, flipping and shifting the original picture.</p> <p>The advantages of data augmentation include increasing the dataset and therefore allowing for <strong>more training</strong> as well as <strong>preventing overfitting</strong>. Data Augmentation is achieved by using the <strong>ImageDataGenerator</strong> which considers rotation, shift, shear, zoom and flip hyperparameters.</p> <script src="https://gist.github.com/mphamsy/012e06c4f986a7154e491b3ab81ee25b.js"></script> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Train: Found 3500 validated image filenames.
Test: Found 1500 validated image filenames.
</code></pre></div></div> <h4 id="data-augmentation-results"><strong>Data Augmentation Results</strong></h4> <p>12 images displaying the data augmentation results are presented below.</p> <script src="https://gist.github.com/mphamsy/2392c2cc81c6279ff490aa6085b0a5a1.js"></script> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/aug.JPG-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/aug.JPG-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/aug.JPG-1400.webp"></source> <img src="/assets/img/aug.JPG" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Data Augmentation" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The Data Augmentation results </div> <p><br></p> <h3 id="convolutional-neural-network-cnn"><strong>Convolutional Neural Network (CNN)</strong></h3> <p><strong>Architecture Summary:</strong> The input layer consisted of images each with size 128x128x3.</p> <p>The first part of our model consisted of two blocks of Convolution-Relu-BatchNormalisation-MaxPooling layers of size 128x128x8 and 32x32x8, respectively. With the aim of these blocks being to extract low-level features such as edges between background and faces in the image. The drop-out of 0.15 is applied at the end, before age and gender split. Following the split, Convolution-Relu and MaxPooling along with drop-out layers of 0.3 are applied for each branch to finally generate an output ina dense layer.</p> <p><strong>Architecture:</strong></p> <script src="https://gist.github.com/mphamsy/039c58a9c807297cf9f8a9175b08f61b.js"></script> <div class="row"> <div class="col"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/CNNmodel.JPG-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/CNNmodel.JPG-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/CNNmodel.JPG-1400.webp"></source> <img src="/assets/img/CNNmodel.JPG" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="CNN architecture" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The CNN architecture </div> <p><br></p> <h3 id="training"><strong>Training</strong></h3> <p>Once the architecture model was completed, the model was subsequently trained. The model was trained for 45 epochs with binary cross entropy loss for the gender classification and mean absolute error loss for the age estimatetion.</p> <script src="https://gist.github.com/mphamsy/e39d1fe4e4e46621dc5903b2a475de52.js"></script> <h3 id="plots-and-results"><strong>Plots and Results</strong></h3> <p>The model has achieved <strong>88.08% accuracy and 7.12 MAE</strong> for age gender estimation. The results are satisfactory considering a small training dataset size and short duration of the training.</p> <p>The training curves were plotted, which show that <strong>no-over or underfitting occurs</strong> due to drop-outs and the data augmentation.</p> <script src="https://gist.github.com/mphamsy/8105c3aa601c58ded307b15e5268a387.js"></script> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/cnnlc.JPG-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/cnnlc.JPG-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/cnnlc.JPG-1400.webp"></source> <img src="/assets/img/cnnlc.JPG" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="Lerning curves" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The learning curves </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2022 Michal Pham Sy. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>